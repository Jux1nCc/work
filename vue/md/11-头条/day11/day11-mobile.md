# day11-mobile

## 概述

### 复习

详情页面：

+ 关注 & 取关作者
+ 点赞 & 取消点赞
+ 不喜欢 & 取消不喜欢
  + 返回数据中的 attitude：
    + -1：无态度
    + 0：不喜欢
    + 1：点赞
+ 渲染文章的评论
+ 添加文章的评论
+ 封装评论的回复面板
+ 显示当前点击的评论数据
  + 使用到兄弟组件之间的传参：eventbus
+ 渲染当前评论的回复数据

### 今日内容

详情页面：

+ 解决渲染评论的 bug
+ 完成评论的回复功能

完成我的页面

完成个人信息页面

## 详情页面

### 详情页面 - 渲染评论的bug

表现：

+ 第一次打开评论的回复，功能正常的
+ 第二次打开评论的回复，回复数据无法正常加载

原因：

+ 第一次打开的评论面板其实与第二次打开的是同一个
+ 页面上的数据会在第一次打开就加载完毕，第二次打开就直接使用了第一次的数据

解决方案：

+ 在每次进入这个评论的回复面板时将上一次加载的数据清除掉

### 详情页面 - 完成评论的回复

步骤：

+ 1.0 在页面上添加一个 write 组件：用来添加回复
+ 2.0 在 write 中书写内容
+ 3.0 给发送按钮添加点击事件：
  + 这个事件中应该实现两个功能：
    + a. 添加文章的评论
    + b. 添加评论的回复
  + 为了区分这两个功能：
    + 使用 write 组件时，需要传入一个参数： `isReply`
      + 如果 `isReply` 为  `true` :  实现 添加评论的回复
      + 如果 `isReply` 为 `false` ： 实现 添加文章的评论
+ 4.0 将回复的内容提交到服务器
  + 请求服务器的接口：（添加评论或评论回复）
    + 路径： `comments `
    + 方式：` POST `
    + 功能：
      + 之一：添加评论
      + **之二：添加评论的回复**
    + 参数：
      + body：
        + target：目标的 id
          + 添加评论：文章的 id
          + **添加评论的回复：评论的 id**
        + content：评论的内容
        + art_id：
          + 添加评论：不用传
          + **添加评论的回复：评论所属文章的 id**
+ 5.0 接收返回的回复数据
+ 6.0 将数据渲染到页面上

### 详情页面 - 在首页中跳转到详情中

## 我的页面

### 我的页面 - 静态页面

+ 结构 & 样式
  + 作者信息区域：
  + 收藏区域
  + 消息区域

### 我的页面 - 数据的渲染

+ 步骤

  + 1.0 在打开页面时得到用户的相关信息
    + 请求服务器接口（获取用户自己信息）
  + 2.0 并且渲染到页面上

### 复习上午

详情页面：

+ 解决回复面板中的 bug
+ 添加评论回复数据

我的页面：

+ 完成静态页面
+ 动态渲染数据


## 个人信息

### 个人信息 - 创建组件

+ 创建组件 & 创建路由
+ 设置入口
  + 在我的页面的用户头像位置

### 个人信息 - 完成结构 & 样式

组成：

+ 头部标题
+ 信息一区域
+ 信息二区域

### 个人信息 - 渲染用户信息

步骤：

+ 1.0 在打开页面时，得到用户的信息
  + 请求服务器接口：获取用户自己信息
    + 头像 & 昵称 & 介绍
  + 请求服务器接口：获取用户个人资料
    + 性别 & 生日
+ 2.0 保存用户的信息
+ 3.0 将用户信息渲染到页面上

注意点：

+ 如果直接将用户信息渲染到页面上是不行的
  + 因为数据的响应式是有前提条件的

### 个人信息 - 修改用户信息

步骤：

+ 1.0 点击需要修改的选项
+ 2.0 弹出一个修改面板在面板中显示内容
+ 3.0 修改内容，点击保存，修改信息
  + 请求服务器接口：

注意点：

+ 完成其它属性修改时可以使用的组件：
  + name:  field 输入框组件 [传送门](https://youzan.github.io/vant/#/zh-CN/field)
  + intro: field 输入框组件 [传送门](https://youzan.github.io/vant/#/zh-CN/field)
  + gender：选择器 [传送门](https://youzan.github.io/vant/#/zh-CN/picker)
  + birthday：时间选择器 [传送门](https://youzan.github.io/vant/#/zh-CN/datetime-picker)

### 个人信息 - 头像的上传

步骤：

+ 1.0  点击头像选项打开一个头像操作面板

  + 封装一个头像操作面板

+ 2.0  点击从相册中选择：弹出图片选择器

  + 打开图片选择器使用一个： `<input type="file">` 开启
  + 这个上传框必须隐藏
  + 将来点击从相册中选择，应该触发上传框的点击事件

+ 3.0  选中图片，弹出一个图片预览框

  + 得到选择的图片：

    + 在上传框中有一个事件： `onchange` 事件可以得到图片的变化

  + 使用 vant 中的组件：[ImagePreview](https://youzan.github.io/vant/#/zh-CN/image-preview)

  + 为了能够让图片正常显示在组件中：应该将图片对象转为一个图片地址

    + 方法一： `URL.createObjectURL`

      + 这种方式兼容性会差一点

    + 方法二： `fileReander`

      ```js
      // 得到要转换的图片对象
      var file = document.querySelector('input[type=file]').files[0]
      // 创建一个 fileReader 对象
      var reader = new FileReader()
      // 调用方法进行转换
      reader.readAsDataURL(file)
      // 接收转换的结果：转换之后执行的事件
      reader.addEventListener('load', function() {
          // 可以通过 render.result 得到转换之后的 URL
      })
      ```

+ 4.0  点击关闭图片，弹出一个提示框：访问用户是否将图片设置为头像

  + 给预览框设置一个关闭事件：

    ```js
    ImagePreview({
      images: [
        'https://img.yzcdn.cn/vant/apple-1.jpg',
        'https://img.yzcdn.cn/vant/apple-2.jpg',
      ],
      onClose() {
        // do something
      },
    });
    ```

+ 5.0 点击确定，将头像进行修改

  + 将图片提交到服务器
    + 请求服务器接口（编辑用户照片资料（头像、身份证照片））
    + bug：
      + 表现：提交到服务器的图片为空
      + 原因：
        + 由于异步请求时，请求的参数中有文件，文件是无法提交到服务器中的
      + 解决方案：
        + 可以使用 `formData` 来管理数据就 OKEY 了