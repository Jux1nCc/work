# day10-mobile

## 概述

### 复习

搜索结果：

+ 完成了上拉加载更多

判断登录：

+ 在方法中完成了判断登录
+ 将判断登录的逻辑代码封装到一个全局方法中
+ 将判断登录的逻辑代码封装为一个单独的插件
+ 验证登录成功之后跳转到登录之前的页面
+ token 失效之后的处理方式

插件：

+ 可以给 vue 添加额外的功能

+ 使用：

  + 定义插件：

    ```js
    export default {
      install: function(Vue) {
      	// 可以在 vue 中添加一些额外的方法 & 属性
      }
    }
    ```

  + 使用插件：

    ```js
    Vue.use(myplugin) // 调用插件的 install 方法
    ```

详情页面：

+ 创建路由
+ 完成静态页面
  + 将单条评论封装为组件
  + 将评论书写区域封装为组件
+ 完成文章详情的数据渲染

### 今日内容

详情页面：

+ 关注&取消关注
+ 点赞&不喜欢
+ 渲染文章的评论
+ 添加文章的评论
+ 渲染文章评论的回复
+ 添加文章评论的回复

## 详情页面

### 详情页面 - 关注作者

步骤：

+ a. 给关注按钮添加一个点击事件
+ b. 在事件中：
  + 得到当前文章作者的 id
  + 将 id 提交到服务器，关注作者
    + 请求服务器接口（关注用户）
  + 手动将用户的关注状态设置为 true

### 详情页面 - 取关作者

步骤：

+ a. 给已关注按钮添加一个点击事件
+ b. 在事件中：
  + 得到当前文章作者的 id
  + 将 id 提交到服务器，取消关注作者
    + 请求服务器接口（取消关注用户）
      + url： /user/followings/:target 
      + method： DELETE 
      + 参数：
        + 路径 参数（写在路由上的）
          + target：作者的 id
      + 返回数据
  + 手动将用户的关注状态设置为 false

### 详情页面 - 点赞

步骤：

+ a. 给点赞（默认样式）按钮添加一个点击事件：
+ b. 在事件中：
  + 得到文章的 id
  + 将文章 Id 提交到服务器，对文章进行点赞
    + 请求服务器的接口（对文章点赞）
  + 手动将文章的 态度 属性设置为 1

### 详情页面 - 取消点赞

步骤：

+ a. 给点赞（红色）按钮添加一个点击事件：
+ b. 在事件中：
  + 得到文章的 id
  + 将文章 Id 提交到服务器，对文章进行取消点赞
    + 请求服务器的接口（取消对文章点赞）
  + 手动将文章的 态度 属性设置为 -1

### 详情页面 - 不喜欢

### 详情页面 - 取消不喜欢

### 详情页面 - 渲染评论数据

> 准备工作：将评论数据放到 list 组件中进行渲染

步骤：

+ 1.0 得到当前文章的评论数据：
  + 在 `list ` 的 `onloade` 事件中去请求服务器接口
    + 请求服务器接口（获取评论或评论回复）
  + 得到当前文章的评论数据
  + 保存最后一页的标识
  + 保存下一页的标识
+ 2.0 将文章评论数据保存起来
+ 3.0 将评论数据渲染到页面上

注意点：

+ 得到文章评论数据的接口：

  + 路径：`  /app/v1_0/comments `

  + 方式：`GET`

  + 功能：

    + **之一：获取评论（得到文章的评论数据）**
    + 之二：获取评论回复（得到文章的评论下的回复信息）

  + 请求参数：

    + query：将参数放到路径后面
      + type：功能的类型
        + **a：请求这个接口的目的是得到文章的评论数据**
        + c：请求这个接口的目的是得到文章评论的回复
      + source：
        + **如果要得到文章的评论数据：文章的 id**
        + 如果要得到文章评论的回复：评论的 id
      + offset：分页的关键字
        + 如果请求第一页： offset 可以不传
        + 如果请求第二页：offset 要传入的值是第一页返回的 last_id
        + 如果请求第三页：offset 要传入的值是第二页返回的 last_id
        + ....
        + 如果得到的  last_id 与 end_id 相同，则说明当前评论数据已经全部获取了
      + limit：页容量

  + 返回数据

    ```json
    {
    	message: 'OK', // 响应的信息
    	data: {
    		total_count: 712, // 评论的总条数
    		end_id: 1572237141, // 最后一页的标识
    		last_id: 1583649843, // 下一页的标识
    		results：[] // 返回的评论数据
    	}
    }
    ```

### 详情页面 - 将评论数据渲染到评论组件中

> 由于评论组件中的数据现在是默认写死的，为了能够显示评论的数据，我们需要做以下操作

步骤：

+ 1.0 在遍历生成 `comment` 组件时，将 遍历出来的评论数据传入到 `comment` 组件中 
+ 2.0 在  `comment` 组件中接收数据
+ 3.0 将接收到的数据渲染到 `comment` 组件中

### 详情页面 - 完成添加评论

步骤：

+ 1.0 在 write 组件中的输入框中输入内容
+ 2.0 得到输入框中的内容，将内容提交到服务器
  + 请求服务器接口（添加评论或评论回复）
+ 3.0 接收服务器响应的数据（本次添加的评论数据）
+ 4.0 将新的评论数据渲染到页面上
  + 问题：
    + 服务器响应的数据是响应到 `write` 组件中的
    + 渲染数据应该是在 `detail` 中渲染
    + `detail` 与 `write` 之间是父子关系
  + 解决：
    + 在 `write` 中接收到服务器返回的数据之后
    + 将数据从 `write` 中传入到 `detail` 组件中
    + 由于是 `write` 与 `detail` 是父子关系，可以使用 **子传父**

注意点：

+ 添加评论的接口：

  + 路径：`comments`

  + 方式： `POST`

  + 功能：

    + **之一：添加评论**
    + 之二：添加评论的回复

  + 参数：

    + body

      + target：目标 id
        + **文章的 id：添加文章的评论**
        + 评论的 id：添加评论的回复
      + content：添加的内容

      + art_id：非必须
        + **添加文章的评论：不用传**
        + 添加评论的回复：传入评论所属文章的 id

### 复习上午

详情页面：

+ 关注 & 取关作者
+ 点赞 & 取消点赞功能
+ 不喜欢 & 取消不喜欢功能
+ 渲染评论数据：
  + 得到评论数据的接口：
    + 得到文章的评论
    + 得到评论的回复
+ 将评论数据渲染到评论组件中
+ 完成评论的添加

### 详情页面 - 封装评论回复的面板

步骤：

+ a. 在 detail/com 添加一个 reply.vue 组件

  + 添加一个弹出层，默认是隐藏的
+ b. 在 index.vue 中使用这个组件
+ c. 给回复按钮添加一个点击事件，显示这个组件

### 详情页面- 完成回复面板的结构 & 样式

组成：

+ 当前评论
+ 评论的回复

### 详情页面 - eventbus

> 在 vue 中经常涉及到组件之间的传参，但是如果是兄弟组件之间传参太麻烦了，为了解决这个问题可以使用： eventbus

作用：**用来解决兄弟组件之间传参问题**

步骤：

+ 1.0 创建一个公用的 `bus` 对象： `var bus = new Vue()`
+ 2.0 在 `son1` 中向 `bus` 中传入数据：`bus.$emit('fnname', value)`
+ 3.0 在 `son2` 中从 `bus` 中取出数据：`bus.$on('fname', value => { // codeing })`

### 详情页面 - 显示当前点击的评论数据

步骤：

+ a.  在 utils 下创建一个 bus.js 

  + 导入一个 bus 对象

+ b. 在 comment 组件中导入 bus.js 

  + 通过 bus.$emit('passcomment', xxx) 方式传参

+ c. 在 reply 组件中导入 bus.js

  + 在 reply 组件中的 mounted 中
  + 通过 bus.$on('passcomment', xxx => {}) 方式来接收参数

+ d. 使用 comment 组件将参数渲染到页面上

  + 保存当前传入的评论数据
  + 导入 comment 组件
  + 渲染评论数据

### 详情页面 - comment组件中的回复按钮

> 如果 `comment` 组件在 `detail` 中使用，应该显示 回复按钮
>
> 如果 `comment` 组件在 `repaly` 中使用，不应该显示回复按钮

+ 解决方案：
  + 给 `comment` 组件中传入一个属性： `isReply` 
    + 如果 `isReply` 为 `true`：就不显示回复按钮
    + 如果 `isReply`  为 `false`：就显示回复按钮
  + 将来在  `detail` 中使用：传入 `false`
  + 将来在  `repaly` 中使用：传入 `true`

### 详情页面 - 渲染文章评论的回复

步骤：

+ 1.0 在 `replay` 中的 `list` 的 `onload` 事件中
  + 请求服务器接口：（获取评论或评论回复）
    + 接口：` comments `
    + 方式： `get`
    + 功能：
      + 之一：获取文章的评论
      + **之二：获取评论的回复**
    + 参数：
      + query：
        + type：使用功能：
          + a：获取文章的评论
          + **c：获取评论的回复**
        + source:
          + 获取文章的评论：文章的 id
          + **获取评论的回复：评论的 id**
        + offset：分页的标识
          + 第一页：不用传
          + 第二页：传入第一页中返回的 `last_id`
          + 第三页：传入第二页中返回的 `last_id`
          + 。。。。
          + 如果 `last_id` 与 `end_id` 相同，说明数据已经加载完毕
        + limit：页容量
  + 得到评论的回复数据
+ 2.0 保存回复数据
+ 3.0 将回复数据渲染到页面上

### 详情页面 - 完成评论的回复

> 说明：write 组件被两个组件使用过并且功能不一样
>
> > `detail`：用来添加文章的评论
> >
> > `reply`：用来添加评论的回复
>
> 结论：
>
> > 将来在使用 `write` 组件：应该根据它所在的页面的不同，执行不同的逻辑代码
> >
> > 也可以给 write 中添加一个属性： isReply
> >
> > > 在 detail 中使用时：isReply 传入一个 false, 执行添加文章评论的逻辑
> > >
> > > 在  reply 中使用时：isReply 传入一个 true，执行添加评论的回复的逻辑

步骤：

+ 1.0 在页面上添加一个 write 组件：用来添加回复
+ 2.0 在 write 中书写内容
+ 3.0 将回复的内容提交到服务器
+ 4.0 接收返回的回复数据
+ 5.0 将数据渲染到页面上