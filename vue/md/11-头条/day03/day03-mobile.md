## day03-mobile

## 概述

### 复习

webpack：

+ 配置项
+ loader
+ 插件

移动端：

+ 项目的开发流程
+ 前端的职责：
  + 根据**设计稿**完成静态页面
  + 根据**接口文档**完成数据的渲染
+ 技术选型：
  + vue & vue 全家桶
  + vue 全家桶：
    + vue & axios & vue-router & vuex & dev-tool

创建项目：

+ 使用 vue-cli 创建项目
+ 项目运行流程
  + 请求静态页面：`public/index.html`
    + 运行项目之后会导入 `src` 目录中所有内容打包后的 js 文件
  + 逻辑代码：`src` 目录下
    + `main.js` 入口文件
      + 导入 `vue`
      + 导入 `app`
        + 项目的根组 件
      + 导入 `router`
        + 项目的路由
      + 导入 `store`
        + 项目的 vuex
      + 将 `app & router & store` 挂载到 `vue` 实例中
      + 将 `vue` 实例挂载到页面上

eslint 中的标准规范

### 今日内容

改造项目结构

vant 的使用

登录

强烈建议：

​	从现在开始黑马面面如果还没有写完的同学，不要再写了。因为我们要开始新的项目了。

从今天开始：

​	每天自习我会检查6位同学的代码情况。

## 准备工作

### 准备工作 - 预览项目

[在线地址传送门](http://toutiao.research.itcast.cn/#/login) 

建议：下载一个今日头条 App

项目内容：

+ 登录页面
  + 默认帐号 & 验证码
    + 13911111111
    + 246810
+ 首页
+ 搜索页面
+ 搜索结果
+ 文章详情
  + 文章的评论 & 评论的回复
+ 我的页面
+ 个人信息
+ 小智机器人

### 准备工作 - 项目开发流程

阶段：

+ 产品经理：
  + 分析需求：
    + 整理出一个需求文档
  + 绘制流程图
  + 绘制原型图
+ 视觉设计师（ui）
  + 以原型图为基础
    + 设计出来设计稿
+ 项目经理
  + 根据需求文档
    + 整理出一个开发文档
+ 后端工程师：
  + 根据开发文档
    + 开发接口
+ 前端工程师：
  + 根据设计稿
    + 完成静态页面
  + 根据开发文档
    + 完成数据渲染
+ 测试小哥哥（小姐姐）
  + 测试项目的 bug
+ 运维
  + 发布上线

注意点：

+ 在实际开发过程中可能我们的开发环境会比上面要少一个到多个环节

### 准备工作 - 前端的职责

+ 负责：
  + 根据设计稿来书写静态页面
  + 根据接口文档来调用接口渲染数据
+ 需要准备的材料：
  + 设计稿
  + 接口文档

### 准备工作 - 技术的选型

> 一般技术造型是由项目的负责人来负责的

主体技术：

+ vue

其它技术：

+ 搭建项目结构： vue-cli
+ 管理路由：vue-router
+ 管理页面上的全局数据：vuex
+ 发送网络请求： axios
+ 完成页面结构的搭建：vant
  + 它是基于 vue 的组件库
  + 它是移动端的组件库（自动适配屏幕）
+ ....

## 搭建项目结构

### 搭建项目结构 - 使用脚手架来搭建项目(vue-cli)

步骤：

+ 1.0 在桌面上打开终端
+ 2.0 使用终端创建一个项目
  + 执行指令： `vue create heimatt`
    + 生成项目时选择： ` Manually select features`
    + 选择自己项目中需要用到的特性： `babel、vuex、vue-router、css Pre-process、eslint`
    + 是否开启 `history` 模式
    + 选择一个 css 预处理器
    + 选择 eslint 的校验时机
    + 设置保存特性的位置
    + 将以上操作保存为单独的选项
    + 设置选项的名称
    + 下载项目

注意点：

+ 1.0 以前在使用 vue 创建项目时，只用到了 default 选项

+ 2.0 将选好的特性保存为一个单独的选项之后：

  + 这个选项会出现在

    ![1585798751388](img\1585798751388.png)

问题：

+ 1.0 项目创建好了，但是不知道在哪里

  + 一般在终端中创建出来的项目都在终端现在处于的位置中

+ 2.0  cmd 与 powershell 的区别

  + CMD 与 powershell 一样都是终端，也都是 window 系统自带的

+ 3.0 怎么打开 powershell

  + 方式 1：
  
+ 在桌面 : shift + 右键 ----> 在此处打开 powershell
  
  + 方式 2：
    + window + R  ---> 输入  powershell 
    
    + 切换到桌面
    
      ![1587543718131](img\aabb)

### 搭建项目结构 - lint ***“标准”*** 规范

> 创建项目时选择的特性有：
>
> > babel： 将 es6 转为 es5 的语法
> >
> > Router: 在项目中使用 vue-router
> >
> > Vuex：在项目中使用 Vuex
> >
> > CSS Pre-processors：使用  css 预处理器
> >
> > Linter：说明这个玩意儿

Linter

+ 作用：用来规范 js 的写法。它就是一个规范

+ 类型：
  + Airbnb：爱彼迎规范
    + 是国外的一家叫 `爱彼迎` 的公司出产的规范
  + Standard：标准规范
    + 这种规范的名字叫做 `标准`

Standard 具体规定：[传送门](https://github.com/standard/standard/blob/master/docs/README-zhcn.md)

+ 1.0 缩进使用两个空格

+ 2.0 字符串使用单引号

+ 3.0 句未不能以分号结尾

+ 4.0 行首不要以 (, [ 开头

+ 5.0 关键字后面必须加空格

+ 6.0 函数名后面必须加空格

+ 7.0 不要有冗余的变量

+ 8.0 使用 `===` 替换 `==`

+ 9.0 使用浏览器全局变量时加上 window 前辍

+ 10.0 注释的双斜杠后面必须加一个空格

+ 11.0 行未千万不加空格

+ 12.0 每个文件结束之后必须添加一个新的换行

+ 13.0 空行不能同时存在多个

注意点：

+ 如果错误过多，可以使用一个指令来一次性将错误全部修复：`npm run lint --fix`
  + 这个指定有个限制：只能帮助我们修改语法错误，不能帮助我们修改代码
+ 使用了这个 `标准` 规范之后，不要再使用 vscode 中的格式化快捷键

作业：

+ 在网上可以找到自动修复语法错误的方法，大家自动解决试试

### 搭建项目结构 - 项目的运行流程

静态页面：

+ `public/index.html`：用来显示内容
  + 提供了一个  id="App" 的容器

逻辑代码：

+ 入口： `src/main.js`
  + 导入了 `Vue` & `App.vue` & `router` & `store`
  + 创建一个 Vue 实例：
    + 挂载了  `router` ： vue-router
    + 挂载了 `store`： vuex
    + 将 `App` 根组件渲染到了 Vue 实例中
    + 将 `vue` 实例挂载到页面上  id="App" 的容器中
+ 根组件： `src/App.vue`
  + 标准的 `.vue` 文件：
    + template
    + script
    + style
+ 路由： `src/router.js`
  + 创建路由信息
+ 仓库： `src/store.js`
  + 创建 `仓库` 对象

### 搭建项目结构 - 改造项目结构

删除不需要的文件：

+ 将 `compoents` 下面的所有内容全部删除
+ 将 `views` 下面的所有内容删除
+ 将 `App.vue` 中的内容全部清除，只留下一个 `<router-view></router-view>`
+ 将 `router.js` 中导入的路由文件删除，清空路由信息

添加文件夹：

+ `api`：管理所有的网络请求
+ `style`：管理所有的全局样式
+ `utils`：管理所有的自己定义工具类
+ `router`：管理路由
+ `store`：管理仓库
+ assets：管理所有的静态资源
+ components：管理全局的组件
+ views：管理当前项目中的页面组件

## vant

> [官网传送门](https://youzan.github.io/vant/#/zh-CN/)
>
> 作用：轻量、可靠的移动端 Vue 组件库 

### vant - vant 的使用 

使用步骤：

+ 1.0 安装 vant ：`npm i vant -S `

+ 2.0 导入组件（导入所有组件的方式）

  ```js
  import Vue from 'vue'
  import Vant from 'vant'
  import 'vant/lib/index.css'
  // 使用 vant
  Vue.use(Vant)
  ```

+ 3.0 使用 vant

  + 单独创建一个 .vue 文件来使用

使用 vant 中的组件：

+ 按钮的使用：

  ![1585816446710](img\1585816446710.png)

+ 单元格的使用

  ![1585816596050](img\1585816596050.png)

+ icon 图标的使用

![1585816755001](img\1585816755001.png)

### vant - vant 中的插槽

> 如果需要在 cell（单元格之内添加其它的图标），必须使用插槽

总结：

+ 将要使用插槽的组件，从单标签改为双标签
+ 添加一个容器 `template`
+ 给 `template` 添加插槽的属性: `#title` & `#default`
+ 在 `template` 标签之中添加内容

## 登录

### 登录 - 用户故事

项目类型：黑马头条（类似于：今日头条）

特点：

+ 1.0 用户登录是可以访问的，用户不登录也应该可以访问
+ 2.0 如果用户之前登录过：
  + 直接输入之前登录过的信息，就可以再次登录
+ 3.0 如果用户之前没有登录：
  + 直接输入用户的手机号 & 验证码，就可以创建一个新的用户，并且进行登录

### 登录 - 完成静态页面

添加一个登录页面：

+ 创建一个 login 组件
+ 设置 login 路由
+ 完成静态页面

组成：

+ 头部标题

  > 使用 vant 中 navBar 组件  [传送门](https://youzan.github.io/vant/#/zh-CN/nav-bar)

  说明：

  + 不给 `style` 添加 `scoped` 属性：样式可以直接作用到 `navBar` 生成的结构中
  + 但是一旦设置了 `scoped` 属性：样式无法作用到 `navBar`  生成的结构中了
  + 如果要让样式作用到生成的结构中：
    + 1）可以去掉 `scoped`
    + 2）可以给样式添加一个深度选择器： `/deep/`
      + 作用：让设置了 `scoped` 属性的样式作用到生成的结构中
      + 注意点：`/deep/` 必须配置 `less` 语法来使用

  ![1587610777888](img\1587610777888.png)

+ 手机号 & 验证码输入框

  > 使用 vant 中 field 组件 [传送门](https://youzan.github.io/vant/#/zh-CN/field)

+ 登录按钮

  > 使用 vant 中的 button 组件 [传送门](https://youzan.github.io/vant/#/zh-CN/button)

### 登录 - 使用 iconfont 

> 由于输入框之前有两个图标，在 vant 的图标库中没有这两个图标，为了解决这个问题 ，我们需要使用 iconfont 来加载这个图标

步骤：

+ a. 生成 css 文件
  + 1.0 打开 iconfont 的官网 [传送门](https://www.iconfont.cn/)
  + 2.0 去官网中找到自己要的图标 & 添加到购物车中
  + 3.0 将我们需要的图标添加一个项目中
  + 4.0 生成这个图标的 css 文件
+ b. 在项目中使用 iconfont
  + 1.0 复制生成的 css 代码
  + 2.0 在项目中的 `src/style` 中创建一个 `index.css`  并且将 css 代码粘贴到文件中
  + 3.0 在 `main.js` 中导入这个文件
  + 4.0 使用： `<i class="iconfont 图标的名称"></i>`

### 登录 - 完成参数的合法性验证 

> 点击登录之后，应该判断手机号&验证码是否合法
>
> > 如果合法：继续向后执行逻辑代码
> >
> > 如果不合法：
> >
> > > 在手机号 & 验证码下方添加说明信息

步骤：

+ 1.0 在输入框中输入内容
+ 2.0  给按钮添加一个点击事件：
  + 在事件中对参数进行合法性验证

### 登录 - vant 中的验证属性

> 要给 filed 添加验证信息，应该使用：  error-message 属性

属性：

+ error-message

特点：

+ 1.0 如果 error-message 有内容，会在页面上显示内容
+ 2.0 如果 error-message 无内容，页面上不会显示内容

### 登录 - 封装合法性验证逻辑

> 由于 login 方法应该只是用来处理登录逻辑的，所以我们需要将合法性验证的逻辑提取为一个方法

步骤：

+ 1.0 在 methods 中创建一个方法 `checkdata`
+ 2.0 将验证的逻辑代码放到 `checkdata`

注意点：

+ 将验证逻辑封装为一个方法之后还可以添加其它的验证

### 登录 -  提交登录的参数

步骤：

+ 1.0 在 `login` 方法中得到要提交的参数
+ 2.0 将数据提交到服务器
  + 下载 axios
  + 导入 axios
  + 请求接口提交数据：用户认证（登录注册）
  + 接收返回的数据
  + 跳转到首页

### 登录 -  封装 axios 请求文件

步骤：

+ 1.0 在 `utils` 目录下创建一个文件 `myhttp.js`
+ 2.0 在文件中：
  + 导入 axios
  + 创建一个 axios 对象
  + 设置拦截器

### 登录 - 封装网络请求文件

步骤：

+ 1.0 在 `api` 目录下创建一个文件： `use.js`
+ 2.0 在文件中
  + 导入 `myhttp.js` 
  + 封装一个请求登录页面的接口
+ 3.0 在 `login/index.vue` 中使用这个方法

### 登录 - async & await 的作用

> 问题：在开发过程中我们进行网络请求之后，需要将处理的结果放到回调函数中处理，这样子会响应代码阅读性。
>
> 为了解决这样的问题：在 es 的新版本标识中出了一个新的技术： async & await

作用：

+ 将异步的代码以同步的方式进行书写

用法：

+ `async` 用来修饰异步代码所在的函数
+ `await` 用来修饰异步代码
+ 使用 `await` 修饰后的异步代码可以同步的方式来接收返回结果

注意点：

+ async & await 并没有改变代码：只是将代码的执行步骤进行了调整：
  + 没有使用 async & await 之前：
    + 遇到异步代码，会先执行同步代码，等待异步代码返回结果之后再执行
  + 使用了 async & await 之后：
    + 遇到 await 修饰后的代码，会等待这个异步代码返回结果，再执行后续的逻辑

### 登录 - 保存登录信息到 vuex & localstorage 中

> 登录成功之后，在跳转到首页之前，应该将用户信息保存起来。数据的保存会保存到两个位置：
>
> > store： 保存到仓库中
> >
> > > 为了方便将来在书写项目时使用
> >
> > localstorage ：保存到本地
> >
> > > 为了重新打开页面，保存的状态依旧存在

步骤：

+ 1.0 在 `store` 中 的 `state` 下创建一个属性： `userInfo`
+ 2.0 在 `store` 中的 `mutations` 下创建一个方法： `setUserInfo`
  + 在方法中给 `userInfo` 赋值
+ 3.0 登录成功之后，应该直接将服务器返回的数据保存到 `store` 中的 `userInfo`
+ 4.0 将用户信息保存到本地： `localstorage`
+ 5.0 默认打开项目时，应该将 `locastorage` 中的数据取出来，放到 `userInfo` 中

### 登录 - localstoreage 的操作方法封装

> 由于将来我们会频繁的对 localstroage 进行操作， 我们可以将操作的步骤封装为一些单独的方法放到一个单独的文件中

步骤：

+ 1.0 在 `utils` 下添加一个文件 `mylocal.js`
+ 2.0 在 `mylocal.js` 文件中封装方法：
  + 存储数据的方法： localSet
  + 取出数据的方法： localGet
  + 删除数据的方法： localDel
+ 3.0 将方法暴露出去

注意点：

+ 取出数据 的方法中需要设置一个 `return`

### 登录 -  给登录添加加载效果

> 登录时，网络可能比较慢，如果不作处理，用户会认为自己没有登录。会多次点击登录按钮。会额外的消耗服务器的性能。

任务：当用户点击一次登录之后，将登录按钮设置为加载状态。

准备知识点：

+ 给按钮添加一个 loading 属性：
  + 值为 true：按钮就会处于加载状态
  + 值为 false：按钮就会处于可用状态

步骤：

+ 1.0 给按钮添加一个 `loading` 属性
+ 2.0 在 `data` 中设置一个 `isLoding` 属性，默认值为 `false`
+ 3.0 在点击按钮时
  + 将 `isLoading` 设置为 true
+ 4.0 当服务器响应回来之后
  + 将 `isLoading` 设置为 false

### 登录 - try-catch的基本使用

> 由于黑马头条接口在登录失败时直接返回一个 400，400 会将浏览器直接报错，无法正常执行后续的代码。要解决这个问题，可以使用 try-catch 来捕获错误

try-catch 的用法：

```js
try {
	// 可以会出错的代码
} catch (error) {
	// 如果出错，就执行 catch 中的代码，
    // 如果不出错，就不执行 catch 中的代码
    // error: 指的就是出错的信息
}
```

try-catch 的作用：

+ 正常执行 try 中的逻辑：
  + 如果没有问题就一直执行下去（不执行 catch 中的逻辑）
  + 如果在 try 中的代码有错误，就会马上中断 try 中的逻辑去执行 catch 中的逻辑

### 登录 - 捕获登录失败信息

步骤：

+ 1.0 将 `login` 方法中登录逻辑的代码使用 `try-catch` 包裹起来

### 登录 - 给登录失败添加提示框

> vant 中的提示框是 [toast](https://youzan.github.io/vant/#/zh-CN/toast) 

提示失败： 

+ ` Toast.fail('失败文案'); `

注意点：

+ Toast 使用时与 `element` 中的 `message` 是一样的
  + 如果在 `.vue`  文件中使用： `this.$toast.fail('')`
  + 如果在其它的 `.js` 文件中使用：
    + 导入这个 Toast：`import { Toast } from 'vant'`
    + 使用这个 Toast： `Toast.fail('失败的文案')`