;/*!wap:component/detail_video/detail.js*/
define("wap:component/detail_video/detail",function(require,exports,module){var VideoAction=require("wap:component/common/util/videoAction"),DETAIL=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<a href="javascript:;" id="topDlBannerWrapper" data-app-download-position="hsvideo_top" class="top-guide-wrap">\n    <div class="top-guide">\n        <span class="logo">\n            <img src="'+(null==(__t="//s3.bytecdn.cn/huoshan/resource/wap/static/image/reflow/v3/logo_small_e33c5d1.png")?"":__t)+'" alt="" />\n        </span>\n        <span class="guide-text">\n            鐪嬫瀬鎸� 鐜╃伀灞� 棰嗙孩鍖匼n        </span>\n        <span class="guide-btn">鍏嶈垂涓嬭浇</span>\n    </div>\n</a>\n<div class="video-container">\n    <div class="poster-page">\n        <a href="javascript:;" class="poster-link" data-category="video_reflow" data-label="main" data-action="video_play">\n            <div class="poster-img" style="background-image:url('+(null==(__t=data.video.cover.url_list[0])?"":__t)+"); padding-top:"+(null==(__t=data.posterImgPt)?"":__t)+'">\n            </div>\n            <span class="play-btn"></span>\n        </a>\n    </div>\n    <div class="player-container hidden" style="height:'+(null==(__t=data.playerPosterH)?"":__t)+'">\n        <div class="player" data-src="'+(null==(__t=data.video.url_list[0])?"":__t)+'" data-poster-src="'+(null==(__t=data.video.cover.url_list[0])?"":__t)+'"></div>\n        <div class="player-poster" style="background-image:url('+(null==(__t=data.video.cover.url_list[0])?"":__t)+"); height:"+(null==(__t=data.playerPosterH)?"":__t)+'">\n        </div>\n        <div class="video-mask-bg"></div>\n        <span class="loading-spinner hidden"></span>\n        <span class="play-btn video-play-btn hidden"></span>\n        <div class="replay-mask hidden">\n            <div class="recommend-list-box js-recommend-list" style="'+(null==(__t=data.isSmallVideoRadio?"display:none":"")?"":__t)+'"></div>\n            <div class="replay-box'+(null==(__t=data.isSmallVideoRadio?" center":"")?"":__t)+'">\n                <span class="replay-btn">閲嶆挱</span>\n                <a class="replay-download" href="javascript:;" data-app-download-position="hsvideo_finish">鏇村绮惧僵瑙嗛</a>\n            </div>\n            <div class="guide-up-box'+(null==(__t=data.isSmallVideoRadio?" hidden":"")?"":__t)+'">\n                <span class="up-text">涓婃粦鐪嬫洿澶�</span>\n                <span class="up-icon"></span>\n            </div>\n        </div>\n    </div>\n    <div class="user-info-wrap js-user-follow">\n        <div class="user-info clearfix">\n            <p class="avatar">\n                <img src="'+(null==(__t=data.author.avatar_thumb.url_list[0])?"":__t)+'" alt="" />\n            </p>\n            <div class="user-content">\n                <p class="nickname"><span>'+(null==(__t=_.escape(data.author.nickname))?"":__t)+'</span></p>\n                <p class="short-id"><span>ID:'+(null==(__t=data.author.short_id)?"":__t)+'</span></p>\n            </div>\n            <a href="javascript:;" class="follow-it-btn">鍏虫敞</a>\n        </div>\n    </div>\n    ',data.banner&&(__p+='\n    <a href="'+(null==(__t=data.banner.url)?"":__t)+'" class="activity" style="background-image: url('+(null==(__t=data.banner.image)?"":__t)+')"></a>\n    '),__p+='\n    <a href="javascript:;" class="make-money-wrap" data-app-download-position="hsvideo_money">\n        <span class="text">\n            ',__p+=0==data.stats.income?"\n                杩欎釜瑙嗛姝ｅ湪鐏北璧氶挶鍝︼紒\n            ":"\n                杩欎釜瑙嗛鍦ㄧ伀灞辫禋浜�"+(null==(__t=data.stats.income/100)?"":__t)+"鍏冨摝锛乗n            ",__p+='\n        </span>\n        <span class="gif-icon"></span>\n    </a>\n</div>\n';return __p},RECOMMEND_LIST=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="rec-list">\n    ',_.each(data,function(a){__p+='\n        <a class="item" href="javascript:;" data-item-id="'+(null==(__t=a.id)?"":__t)+'" data-app-download-position="hsvideo_finish">\n            <div class="cover" style="background-image:url(\''+(null==(__t=a.video.cover.url_list[0])?"":__t)+'\')">\n                <span class="play-btn"></span>\n            </div>\n            \n            <div class="bar-container">\n                <div class="bar" style="width:100%" ></div>\n            </div>\n            \n        </a>\n    '}),__p+="\n</div>";return __p};module.exports=Pagelet.extend({el:"#pageletDetail",events:{},channels:{"com.huoshan.reflow.video recomment-video":"onRecommentVideo","com.huoshan.reflow.video set-bar":"countDown"},init:function(a){var n=this;if(this.setting=a||{},this.data=[],this.t=null,a.data&&a.data.id){var t=a.data,i=0;t.video.height&&t.video.width&&(i=t.video.height/t.video.width);var e=$(window).width(),o=document.documentElement.clientHeight||window.screen.height,s=16/9>o/e?o/e:16/9;t.isSmallVideoRadio=!1,i>0&&1.3>i?(t.videoH=Math.ceil(t.video.height*e/t.video.width),t.playerPosterH=t.videoH+"px",t.posterImgPt=Math.ceil(100*t.videoH/e)+"%",t.videoTop=0,t.isSmallVideoRadio=!0):i>=1.3&&s>i?(t.posterImgPt="130%",t.videoH=Math.ceil(t.video.height*e/t.video.width)+"px",t.playerPosterH=t.videoH,t.videoTop=0):i>=s&&(t.posterImgPt="130%",t.playerPosterH=o+"px",t.videoH=Math.ceil(t.video.height*e/t.video.width),t.videoTop=this.calcVideoPos(t.videoH,o)),this.$el.append(DETAIL({data:t})),VideoAction.init(this.el,{videoH:t.videoH,videoTop:t.videoTop,is_ga:!0,startPlayCb:function(){listener.trigger("www.huoshan.reflow","send-act",{act:"play"})},handlerDownload:function(a){listener.trigger("www.huoshan.reflow","send-act",{act:"download"});var t=Common.Util.getUrlParam(location.href,"tag"),i="";t&&(i="?extra="+encodeURIComponent(JSON.stringify({tag:t})),a+=i),window.downloadAction&&function(){window.downloadAction.init({downloadLink:a,type:"item",params:{item_id:n.setting.data.id}})}()}})}n.updateDownload()},countDown:function(a,n){var t=this,i=50,e=4;if("replay"==n["v-state"])return clearTimeout(t.t),void(t.t=null);var o=function s(){if(0>i){t.$el.find(".bar-container .bar").css({width:"100%"}),i=50;var a=t.$el.find(".js-recommend-list a div.cover"),n=t.data.slice(0+4*e,4+4*e);a.each(function(a){var t=n[a].video.cover.url_list[0];$(this).css("background-image","url("+t+")"),$(this).parent().data("item-id",n[a].id)}),e--,0>e&&(e=4)}else if(50!=i){var o=parseFloat(t.$el.find(".bar-container .bar").css("width"))-2+"%";t.$el.find(".bar-container .bar").css({width:o})}else t.$el.find(".bar-container .bar").css({width:"100%"});i--,t.t=setTimeout(s,80)};o()},onRecommentVideo:function(a,n){n&&n.length>0?(this.data=n,this.$el.find(".js-recommend-list").html(RECOMMEND_LIST({data:n.slice(0,4)}))):this.$el.find(".replay-mask .replay-box").addClass("center")},updateDownload:function(){if("huoshan1toutiao"!=CONST.utm_campaign){var a=Common.Util.getUrlParam(location.href,"experiment_dl");if(a){var n=["//d.huoshan.com/",a,"/"].join(""),t=["hsvideo","hsvideo_top","hsvideo_money","hsvideo_bottom","hsvideo_error","hsvideo_profile","hsvideo_finish"];try{window.updateDownloadUrlByCustom(n,t)}catch(i){console.log(i)}}}else try{window.updateDownloadUrlByCampaign("tt_share_dl")}catch(i){console.log(i)}},calcVideoPos:function(a,n){return moveDis=a-n>0?-(a-n):n-a}})});