;/*!wap:component/recommend_video/recommend_video.js*/
define("wap:component/recommend_video/recommend_video",function(require,exports,module){var RECOMMEND=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="header">\n    <span class="title"></span>\n</div>\n<ul class="video-list clearfix">\n    ',_.each(data,function(e){__p+='\n        <li>\n            <a href="/share/video/'+(null==(__t=e.id)?"":__t)+"/"+(null==(__t=search)?"":__t)+'" class="recommend-video-item" data-item-id="'+(null==(__t=e.id)?"":__t)+'">\n                <div class="cover lazy" data-src="'+(null==(__t=e.video.cover.url_list[0])?"":__t)+'">\n                    <span class="play-btn"></span>\n                </div>\n            </a>\n        </li>\n    '}),__p+="\n</ul>";return __p},getVideoUrl=_.template("/share/hot_videos/?offset=0&count=<%= count%>&item_id=<%= item_id%>"),_setting={},PLAYEND_SHOW_COUNT=20;module.exports=Pagelet.extend({el:"#pageletRecVideo",events:{},init:function(e){_setting=e,this.getVideos(),this.doBind()},doBind:function(){var e=this;e.$el.on("click",".recommend-video-item",function(){gaevent("video_reflow","video_play","recommend");var t=$(this).attr("data-item-id"),o={item_id:t};if("sessionStorage"in window){var n=sessionStorage.getItem("com.huoshan.hsvideo-next-count")||0;if(n=parseInt(n,10),1>n)try{sessionStorage.setItem("com.huoshan.hsvideo-next-count",++n)}catch(i){}else{listener.trigger("www.huoshan.reflow","send-act",{act:"download"});var a=window.getDownloadUrlByPosition("hsvideo")||null;if(a){var d=Common.Util.getUrlParam(location.href,"tag"),r="";return d&&(r="?extra="+encodeURIComponent(JSON.stringify({tag:d})),a+=r),e.handleDownload(a,"item",o),!1}}e.handleDownload(a,"item",o)}})},getVideos:function(){var e=this,t=_setting.count||12;e.$dom.loadingVideoTip.removeClass("hidden"),$.ajax({url:getVideoUrl({count:t,item_id:_setting.id}),dataType:"JSON",type:"get",timeout:5e3,success:function(t){var o=JSON.parse(t);if(0==o.status_code){o.data.length<1&&gaevent("reflow-video","render_recommend","data_empty");var n=[];o.data.length>=PLAYEND_SHOW_COUNT&&(n=o.data.splice(0,PLAYEND_SHOW_COUNT)),listener.trigger("com.huoshan.reflow.video","recomment-video",n);var i=o.data.slice(0,12),a=window.location.search;e.$dom.loadingVideoTip.addClass("hidden"),e.$dom.videoListNode.removeClass("hidden").empty().append(RECOMMEND({data:i,search:a}));for(var d in n){var r=n[d].video.cover.url_list[0];e.preload(r)}}},error:function(){e.$el.hide()}})},handleDownload:function(e,t,o){window.downloadAction&&function(){window.downloadAction.init({downloadLink:e,type:t,params:o})}()},preload:function(e){var t=new Image;t.src=e}})});