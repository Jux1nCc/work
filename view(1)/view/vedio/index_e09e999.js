define("wap:page/reflow/reflow_video/index",function(o,e,t){var n=null,i="/share/act/";t.exports=Pagelet.extend({el:"#pageletReflowVideo",events:{},channels:{"www.huoshan.reflow send-act":"onSendAct"},init:function(o){var e=this;if(n=o,!n.data.id)if(n.data.user_id){var t=5,i=null,a=function d(){return 0==t?(clearTimeout(i),void(location.href="/share/user/"+n.data.user_id+"/"+location.search)):(e.$dom.countText.text(t),t--,void(i=setTimeout(d,1e3)))};a()}else e.$dom.skipText.hide();this.doBind()},doBind:function(){var o=this;this.$el.on("click",".js-user-follow",function(e){Common.Util.stopEvent(e,!0),gaevent("video_reflow","profile_click");var t="hsvideo_profile",i=window.getDownloadUrlByPosition(t),a={item_id:n.data.id,gd_label:"click_schema_reflow_guanzhu"};o.handleDownload(i,"item_follow",a)}),this.$el.on("click","[data-app-download-position]",function(e){Common.Util.stopEvent(e,!0),listener.trigger("www.huoshan.reflow","send-act",{act:"download"});var t=$(e.currentTarget).data("app-download-position"),i=window.getDownloadUrlByPosition(t),a={item_id:n.data.id};o.handleDownload(i,"item",a)}),this.$el.find(".js-recommend-list").on("click",".item",function(e){gaevent("video_reflow","finish_video"),listener.trigger("www.huoshan.reflow","send-act",{act:"download"});var t=$(this).attr("data-item-id"),n=$(e.currentTarget).data("app-download-position"),i=window.getDownloadUrlByPosition(n),a={item_id:t,gd_label:"click_schema_reflow_finish"};o.handleDownload(i,"item",a)}),this.$el.on("contextmenu","video",function(){return!1})},handleDownload:function(o,e,t){var n=Common.Util.getUrlParam(location.href,"tag"),i="";n&&(i="?extra="+encodeURIComponent(JSON.stringify({tag:n})),o+=i),window.downloadAction&&function(){window.downloadAction.init({downloadLink:o,type:e,params:t})}()},onSendAct:function(o,e){try{e&&e.act&&(e=$.extend(!0,{item_id:n.data.id},e),$.ajax({url:i,type:"GET",timeout:3e3,data:e,dataType:"json"}).done(function(){}).fail(function(){}))}catch(t){}}})});